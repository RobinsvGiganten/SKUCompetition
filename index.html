<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Memory Match â€“ Custom Combos</title>
  <style>
    :root{ --bg:#0f1221; --panel:#151a2e; --text:#e6e9ff; --muted:#9aa4bf; }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif; color:var(--text);
      background: radial-gradient(1200px 800px at 20% 0%, #1a1f3a, transparent),
                  radial-gradient(1200px 800px at 100% 0%, #122035, transparent),
                  var(--bg);
      display:flex; flex-direction:column; align-items:center;
    }
    header{ width:100%; max-width:1100px; padding:18px 20px; position:sticky; top:0; z-index:5; backdrop-filter: blur(8px); }
    .bar{ display:flex; gap:12px; align-items:center; justify-content:space-between; background:#101633cc; border:1px solid #2a335d; border-radius:16px; padding:12px 14px; box-shadow:0 10px 30px rgba(0,0,0,.35); }
    .left,.right{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .badge{background:#0f1430; border:1px solid #2a335d; padding:8px 10px; border-radius:12px; color:var(--muted)}
    .badge b{color:var(--text)}
    button{ appearance:none; border:none; border-radius:12px; padding:10px 14px; cursor:pointer; background:linear-gradient(180deg,#2a335d,#232a4e); color:var(--text); font-weight:600; box-shadow:inset 0 1px 0 rgba(255,255,255,.08),0 6px 16px rgba(0,0,0,.35) }
    button:hover{filter:brightness(1.08)}
    button:active{transform:translateY(1px)}

    main{width:100%; max-width:1100px; padding:16px 20px 40px}
    .grid{ display:grid; gap:12px; grid-template-columns:repeat(auto-fit, minmax(120px, 1fr)); }
    .card{ aspect-ratio:3/4; perspective:900px; position:relative; outline:none; }
    .card-inner{ position:absolute; inset:0; border-radius:16px; transform-style:preserve-3d; transition:transform .45s cubic-bezier(.2,.7,.2,1); }
    .card.is-flipped .card-inner{ transform:rotateY(180deg); }
    .face{ position:absolute; inset:0; display:grid; place-items:center; border-radius:16px; backface-visibility:hidden; border:1px solid #2a335d; box-shadow:0 10px 20px rgba(0,0,0,.35) }
    .front{ background:linear-gradient(180deg,#22284b,#1a1f3f) }
    .back{ background:linear-gradient(180deg,#202646,#1a1f3b); transform:rotateY(180deg); padding:12px; text-align:center }
    .label{font-weight:700; font-size:clamp(14px,1.5vw,18px)}
    .sub{font-size:.9rem; opacity:.85}
    .imgwrap{ width:100%; height:100%; display:grid; place-items:center }
    .imgwrap svg{ width:70%; height:70% }
    .matched .front{ border-color:#2d9d7c; box-shadow:0 10px 24px rgba(45,157,124,.35) }

    footer{opacity:.7; margin:24px 0 36px; font-size:.9rem}

    dialog{ border:none; border-radius:20px; padding:0; color:var(--text); background:linear-gradient(180deg,#1b2040,#12162e); box-shadow:0 30px 80px rgba(0,0,0,.45); max-width:520px; width:92vw }
    .dlg-body{ padding:24px }
    .dlg-actions{ display:flex; gap:10px; padding:16px 24px; background:#0f1430; border-top:1px solid #2a335d; justify-content:flex-end }
    .sr-only{position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); border:0}
  </style>
</head>
<body>
  <header>
    <div class="bar" role="toolbar" aria-label="Game controls">
      <div class="left">
        <span class="badge" id="moves">Moves: <b>0</b></span>
        <span class="badge" id="time">Time: <b>00:00</b></span>
        <span class="badge" id="best">Best: <b>â€”</b></span>
      </div>
      <div class="right"><button id="restart" type="button">Restart â†»</button></div>
    </div>
  </header>

  <main>
    <h1 class="sr-only">Memory Match Game (Custom Combos)</h1>
    <div id="grid" class="grid" aria-live="polite"></div>
  </main>

  <dialog id="combo">
    <div class="dlg-body">
      <h3>âœ¨ Combo found!</h3>
      <p id="comboText"></p>
    </div>
    <div class="dlg-actions">
      <button id="comboOk">OK</button>
    </div>
  </dialog>

  <dialog id="win">
    <div class="dlg-body">
      <h2>ðŸŽ‰ Nice! You cleared the board</h2>
      <p id="winStats">You finished in 0 moves.</p>
    </div>
    <div class="dlg-actions">
      <button id="playAgain">Play again</button>
      <button id="closeWin">Close</button>
    </div>
  </dialog>

  <footer>
    <p>Custom combos + popups supported. Keyboard: Tab to focus, Enter/Space to flip.</p>
  </footer>

  <script>
  (()=>{
    const grid = document.getElementById('grid');
    const movesEl = document.querySelector('#moves b');
    const timeEl = document.querySelector('#time b');
    const bestEl = document.querySelector('#best b');
    const restartBtn = document.getElementById('restart');
    const dlgWin = document.getElementById('win');
    const playAgain = document.getElementById('playAgain');
    const closeWin = document.getElementById('closeWin');
    const dlgCombo = document.getElementById('combo');
    const comboTextEl = document.getElementById('comboText');
    const comboOk = document.getElementById('comboOk');

    // === Content library ===
    const Items = {
      // Text pairs
      TL: { id:'TL', type:'text', title:'Transformellt Ledarskap' },
      II: { id:'II', type:'text', title:'Idealiserat Inflytande' },
      GM: { id:'GM', type:'text', title:'Growth Mindset' },
      FM: { id:'FM', type:'text', title:'Fixed Mindsset' },
      N3: { id:'N3', type:'text', title:'3' },
      N1: { id:'N1', type:'text', title:'1' },
      APPR: { id:'APPR', type:'text', title:'Appreciative' },
      INQ:  { id:'INQ',  type:'text', title:'Inquiry' },

      // Image pairs (SVG placeholders)
      CHANT: { id:'CHANT', type:'svg', render: svgChanterelle },
      EYE:   { id:'EYE',   type:'svg', render: svgEye },
      LBELT: { id:'LBELT', type:'svg', render: svgLeatherBelt },
      HAMR:  { id:'HAMR',  type:'svg', render: svgHammer },
      CARR:  { id:'CARR',  type:'svg', render: svgCarriage },
      HUN:   { id:'HUN',   type:'svg', render: svgHungaryFlag },
      MAP:   { id:'MAP',   type:'svg', render: svgMap },
      DUMB:  { id:'DUMB',  type:'svg', render: svgDumbbells },
    };

    // Define combos and their popup messages
    const Combos = [
      ['TL','II'],
      ['CHANT','EYE'],
      ['LBELT','HAMR'],
      ['CARR','HUN'],
      ['GM','FM'],
      ['N3','N1'],
      ['MAP','DUMB'],
      ['APPR','INQ'],
    ];

    const comboKey = (a,b)=> [a,b].sort().join('|');
    const comboSet = new Set(Combos.map(([a,b])=>comboKey(a,b)));

    const ComboPopupText = new Map([
      [comboKey('TL','II'), `Hitta vad som driver och utvecklar varje individ. Anpassa ditt ledarskap utefter din grupp`],
      [comboKey('CHANT','EYE'), `Den instÃ¤llningen du har till ett problem pÃ¥verkar hur enkelt du lÃ¶ser ett problem`],
      [comboKey('LBELT','HAMR'), `Vilka verktyg har du fÃ¶r att leda dina medarbetare, verktyg behÃ¶vs slipas och ersÃ¤ttas ibland.`],
      [comboKey('CARR','HUN'), `Coaching, medarbetaren kommer fram till sin egen lÃ¶sning.`],
      [comboKey('GM','FM'), `Se mÃ¶jligheter fÃ¶r att utvecklas, stanna inte i gamla vanor!`],
      [comboKey('N3','N1'), `3 positivt tar ut 1 negativt`],
      [comboKey('MAP','DUMB'), `KartlÃ¤gga styrkor, hitta dina egna styrkor och anpassa ditt ledarskap fÃ¶r att passa dig sjÃ¤lv. Identifiera dina svagheter och kom fram till en fÃ¶rbÃ¤ttringsplan`],
      [comboKey('APPR','INQ'), `Se problem frÃ¥n problem frÃ¥n en positiv infallsvinkel, dÃ¥ blir dom enklare att lÃ¶sa`],
    ]);

    let first=null, second=null, lock=false, matches=0, moves=0, started=false, secs=0, timer=null;
    const totalCards = Combos.length * 2;

    function format(s){ const m=Math.floor(s/60).toString().padStart(2,'0'); const r=(s%60).toString().padStart(2,'0'); return `${m}:${r}`; }
    function startTimer(){ if(timer) return; timer=setInterval(()=>{ secs++; timeEl.textContent=format(secs); }, 1000); }
    function stopTimer(){ clearInterval(timer); timer=null; }
    function resetTimer(){ stopTimer(); secs=0; timeEl.textContent='00:00'; }
    function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]];} return arr; }

    function buildDeck(){
      const ids = Combos.flat();
      const deck = shuffle(ids.slice()).map((id, idx)=>({ key: id+':'+idx+Math.random().toString(16).slice(2,6), id }));
      return deck;
    }

    function renderCardContent(item){
      if(item.type==='text'){
        return `<div class="label">${item.title}</div>`;
      }
      if(item.type==='img' && item.src){
        return `<div class="imgwrap"><img src="${item.src}" alt="${item.alt||''}" style="max-width:70%;max-height:70%"/></div>`;
      }
      if(item.type==='svg' && typeof item.render==='function'){
        return `<div class="imgwrap">${item.render()}</div>`;
      }
      return '<div class="label">?</div>';
    }</div>`;
      }
      if(item.type==='svg' && typeof item.render==='function'){
        return `<div class="imgwrap">${item.render()}</div>`;
      }
      return '<div class="label">?</div>';
    }

    function cardTemplate(card){
      const item = Items[card.id];
      return `<button class="card" data-key="${card.key}" data-id="${card.id}" aria-label="Hidden card" aria-pressed="false">
        <div class="card-inner">
          <div class="face front" aria-hidden="true"></div>
          <div class="face back">${renderCardContent(item)}</div>
        </div>
      </button>`;
    }

    function render(deck){
      grid.innerHTML = deck.map(cardTemplate).join('');
      grid.querySelectorAll('.card').forEach(btn=>{
        btn.addEventListener('click', ()=> flip(btn));
        btn.addEventListener('keydown', (e)=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); flip(btn); }});
      });
    }

    function setFlipped(btn, on){ btn.classList.toggle('is-flipped', on); btn.setAttribute('aria-pressed', on?'true':'false'); }
    function bumpMoves(){ moves++; movesEl.textContent = moves; }

    function flip(btn){
      if(lock) return; if(btn.classList.contains('is-flipped')) return;
      setFlipped(btn, true);
      if(!started){ started=true; startTimer(); }
      if(!first){ first = btn; return; }
      second = btn; lock=true; bumpMoves();

      const id1 = first.getAttribute('data-id');
      const id2 = second.getAttribute('data-id');
      const key = comboKey(id1, id2);
      if(comboSet.has(key)){
        first.classList.add('matched');
        second.classList.add('matched');
        // Show combo popup
        const msg = ComboPopupText.get(key);
        if(msg){ comboTextEl.textContent = msg; dlgCombo.showModal(); }
        first = second = null; lock=false; matches += 2;
        if(matches === totalCards){ win(); }
      } else {
        setTimeout(()=>{ setFlipped(first,false); setFlipped(second,false); first=second=null; lock=false; }, 800);
      }
    }

    function win(){
      stopTimer();
      const stats = `Moves: ${moves} â€¢ Time: ${format(secs)}`;
      document.getElementById('winStats').textContent = stats;
      const bestKey = `best_custom_${totalCards}`;
      const best = JSON.parse(localStorage.getItem(bestKey) || 'null');
      const current = { moves, secs };
      if(!best || current.moves < best.moves || (current.moves === best.moves && current.secs < best.secs)){
        localStorage.setItem(bestKey, JSON.stringify(current));
      }
      updateBestLabel();
      dlgWin.showModal();
    }

    function updateBestLabel(){
      const best = JSON.parse(localStorage.getItem(`best_custom_${totalCards}`) || 'null');
      bestEl.textContent = best ? `${best.moves} / ${format(best.secs)}` : 'â€”';
    }

    function reset(){
      first=second=null; lock=false; matches=0; moves=0; started=false; movesEl.textContent='0';
      resetTimer();
      render(buildDeck());
      updateBestLabel();
    }

    restartBtn.addEventListener('click', reset);
    playAgain?.addEventListener('click', ()=>{ dlgWin.close(); reset(); });
    closeWin?.addEventListener('click', ()=> dlgWin.close());
    comboOk.addEventListener('click', ()=> dlgCombo.close());

    // ===== Inline SVG icon generators =====
    function svgChanterelle(){
      return `
      <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" aria-label="Chanterelle mushroom">
        <defs><linearGradient id="gC" x1="0" x2="0" y1="0" y2="1"><stop offset="0%" stop-color="#ffce57"/><stop offset="100%" stop-color="#e49b2a"/></linearGradient></defs>
        <path d="M20 30 Q50 8 80 30 Q62 40 50 40 Q38 40 20 30 Z" fill="url(#gC)"/>
        <rect x="45" y="40" width="10" height="28" rx="5" fill="#f2c279"/>
      </svg>`;
    }
    function svgEye(){
      return `
      <svg viewBox="0 0 120 80" xmlns="http://www.w3.org/2000/svg" aria-label="Eye">
        <path d="M10 40 Q60 5 110 40 Q60 75 10 40 Z" fill="#dde6ff"/>
        <circle cx="60" cy="40" r="16" fill="#6aa2ff"/>
        <circle cx="60" cy="40" r="8" fill="#2a335d"/>
      </svg>`;
    }
    function svgLeatherBelt(){
      return `
      <svg viewBox="0 0 120 80" xmlns="http://www.w3.org/2000/svg" aria-label="Leather belt">
        <rect x="10" y="34" width="100" height="12" rx="6" fill="#6f4a1d"/>
        <rect x="42" y="28" width="20" height="24" rx="4" fill="#caa24a"/>
        <rect x="58" y="36" width="10" height="8" fill="#4b3314"/>
      </svg>`;
    }
    function svgHammer(){
      return `
      <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" aria-label="Hammer">
        <rect x="60" y="22" width="10" height="56" rx="3" fill="#cf7a2a"/>
        <path d="M58 26 h22 v8 h-22 z" fill="#8a8f9a"/>
        <path d="M58 22 h10 v6 h-10 z" fill="#8a8f9a"/>
      </svg>`;
    }
    function svgCarriage(){
      return `
      <svg viewBox="0 0 120 80" xmlns="http://www.w3.org/2000/svg" aria-label="Carriage">
        <rect x="20" y="28" width="60" height="24" rx="6" fill="#6aa2ff"/>
        <rect x="32" y="18" width="36" height="14" rx="6" fill="#a8c8ff"/>
        <circle cx="36" cy="58" r="8" fill="#2a335d"/>
        <circle cx="36" cy="58" r="3" fill="#dde6ff"/>
        <circle cx="64" cy="58" r="8" fill="#2a335d"/>
        <circle cx="64" cy="58" r="3" fill="#dde6ff"/>
      </svg>`;
    }
    function svgHungaryFlag(){
      return `
      <svg viewBox="0 0 120 80" xmlns="http://www.w3.org/2000/svg" aria-label="Hungary flag">
        <rect x="0" y="0" width="120" height="80" fill="#fff"/>
        <rect x="0" y="0" width="120" height="26.6" fill="#ce2939"/>
        <rect x="0" y="53.3" width="120" height="26.6" fill="#477050"/>
      </svg>`;
    }
    function svgMap(){
      return `
      <svg viewBox="0 0 120 80" xmlns="http://www.w3.org/2000/svg" aria-label="Map">
        <rect x="10" y="20" width="100" height="40" rx="6" fill="#a0c7ff"/>
        <path d="M20 30 L30 25 L45 40 L60 30 L80 45 L100 35" stroke="#1f2a4d" stroke-width="3" fill="none"/>
        <circle cx="45" cy="40" r="4" fill="#1f2a4d"/>
      </svg>`;
    }
    function svgDumbbells(){
      return `
      <svg viewBox="0 0 120 80" xmlns="http://www.w3.org/2000/svg" aria-label="Dumbbells">
        <rect x="30" y="36" width="60" height="8" rx="4" fill="#8a8f9a"/>
        <rect x="22" y="30" width="8" height="20" rx="2" fill="#6e7380"/>
        <rect x="90" y="30" width="8" height="20" rx="2" fill="#6e7380"/>
      </svg>`;
    }

    // init
    reset();
    reset();
  })();
  </script>
</body>
</html>
